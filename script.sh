#!/bin/bash
# set the offline token and checksum parameters
offline_token="eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJhZDUyMjdhMy1iY2ZkLTRjZjAtYTdiNi0zOTk4MzVhMDg1NjYifQ.eyJpYXQiOjE2MzkxMDAwMzMsImp0aSI6IjVjNDEyNGMwLTZiMWMtNGNiMS04ZmEwLTcxOGQ0OTQ1OWRjNCIsImlzcyI6Imh0dHBzOi8vc3NvLnJlZGhhdC5jb20vYXV0aC9yZWFsbXMvcmVkaGF0LWV4dGVybmFsIiwiYXVkIjoiaHR0cHM6Ly9zc28ucmVkaGF0LmNvbS9hdXRoL3JlYWxtcy9yZWRoYXQtZXh0ZXJuYWwiLCJzdWIiOiJmOjUyOGQ3NmZmLWY3MDgtNDNlZC04Y2Q1LWZlMTZmNGZlMGNlNjpza29ieWRhIiwidHlwIjoiT2ZmbGluZSIsImF6cCI6InJoc20tYXBpIiwic2Vzc2lvbl9zdGF0ZSI6IjBkNDY5ZjE0LTYxOWEtNGY2Mi04YTQ3LWM5YWUwOTk1MzM4YiIsInNjb3BlIjoib2ZmbGluZV9hY2Nlc3MifQ.FgR245giJ8WvHOaW6WDinwnx5A4Oa8k89Z0SJEkmezo>"

# get an access token
access_token=$(curl https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token -d grant_type=refresh_token -d client_id=rhsm-api -d refresh_token=$offline_token | jq -r '.access_token')

# get the filename and download url
echo $access_token
echo "HELLO 1"
acess_token="eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICItNGVsY19WZE5fV3NPVVlmMkc0UXhyOEdjd0l4X0t0WFVDaXRhdExLbEx3In0.eyJleHAiOjE2MzkxMDE0NDEsImlhdCI6MTYzOTEwMDU0MSwiYXV0aF90aW1lIjoxNjM5MDk5OTcyLCJqdGkiOiI3YmM4MTMyYy0xYTQzLTQ0OTctOTU1Zi05ZWJkMTVmMWFkMDgiLCJpc3MiOiJodHRwczovL3Nzby5yZWRoYXQuY29tL2F1dGgvcmVhbG1zL3JlZGhhdC1leHRlcm5hbCIsImF1ZCI6InJoc20tYXBpIiwic3ViIjoiZjo1MjhkNzZmZi1mNzA4LTQzZWQtOGNkNS1mZTE2ZjRmZTBjZTY6c2tvYnlkYSIsInR5cCI6IkJlYXJlciIsImF6cCI6InJoc20tYXBpIiwic2Vzc2lvbl9zdGF0ZSI6IjBkNDY5ZjE0LTYxOWEtNGY2Mi04YTQ3LWM5YWUwOTk1MzM4YiIsImFjciI6IjAiLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsicG9ydGFsX21hbmFnZV9zdWJzY3JpcHRpb25zIiwib2ZmbGluZV9hY2Nlc3MiLCJwb3J0YWxfbWFuYWdlX2Nhc2VzIiwicG9ydGFsX3N5c3RlbV9tYW5hZ2VtZW50IiwicG9ydGFsX2Rvd25sb2FkIl19LCJzY29wZSI6Im9mZmxpbmVfYWNjZXNzIiwiYWNjb3VudF9udW1iZXIiOiI5MDE1NzgiLCJhY2NvdW50X2lkIjoiNTMxODI5MCIsInVzZXJfaWQiOiI1MzAyMDY2MyIsIm5hbWUiOiJTaW1vbiBLb2J5ZGEiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJza29ieWRhIiwibG9jYWxlIjoiZW5fVVMiLCJnaXZlbl9uYW1lIjoiU2ltb24iLCJmYW1pbHlfbmFtZSI6IktvYnlkYSIsImVtYWlsIjoic2tvYnlkYUByZWRoYXQuY29tIn0.gu1Z-BuXxscnPgakN72AuvgLDdonbyYclXKFeqhXR2gASnYg2Yz0bElOgPW2O7XYZOP1EIOYkcWm6SuJjVMb0MtMQ3vDlndBodVyP5WzCltZqLrdkyp9qmsQdgyWbgERyJ88MXOxmtykdvewY35SOHW8tTrAjWA_5_HonV1rs5LetrUNmGcforIARaEXN3tiqorEoRWTp_1RJj7DZTVz8LoW_kh8KEoMlRhpkcQeyBXETBCUKyDMfE9x4V_w_PSF2oS7oAxQ0l05jErmojbvhB2BDb-5Q70JEKyuJQBuwhl98w7l2SCHfMl8bCr3ltjvMu-ftMevy97PdeVSeNkdSy9A1DnQjqe0WcYtUF5Hczuxxpg7NCaLruQl2CUreFVXfNtJWPN0yBQ9lwKaDC1xPui0dZpci_bTnznQerbY5bZPOPmtBhON1oXsVvy8bECHOf36-Bahihue-SrzovjeuG5TEgjV7THfFDQExSxa7CC4Q48p5NvkdaAAu0cPicLOfbSCsVQaZDdZhcZyT4kpne8L9Bh-4GQDPamqCWUi_BNofLQPzw7SMgbcp4unohA4WP9TDbO2aihxldMpnwSs0t7sOk1-OnmaagB9nmmr3psk8lHuSInu-khm6ggL5VKjWCAIPmwpFnQ2qT-qwGqOZXFNkP-qCwvSZRUhD09GhIc"
list=$(curl -H "Authorization: Bearer $access_token" "https://api.access.redhat.com/management/v1/images/cset/rhel-8-for-x86_64-baseos-isos")
echo "HELLO 2"
echo $list
checksum="rrew"
image=$(curl -H "Authorization: Bearer $access_token" "https://api.access.redhat.com/management/v1/images/$checksum/download")
filename=$(echo $image | jq -r .body.filename)
url=$(echo $image | jq -r .body.href)

# download the file
curl $url -o $filename
